---
name: Bash test demonstration for Cider-CI

task_defaults:

  eager_trials: 1
  auto_trials: 2
  traits:
    linux: true


subcontexts: 

  - name: Show the environment
    tasks:
    - name: List top level project directory
      scripts: 
        main:
          body: ls -lah
    - name: Show environment variables
      scripts:
        main:
          body: env | sort
    - name: Show functions 
      scripts:
        main:
          body: declare -F | sort
    - name: Specify an port and list env and check 
      ports: 
        xvnc_port: 
          inet_address: "localhost"
          min: 5900
          max: 5999
      scripts:
        main:
          body: env | sort 



  - name: Bash - Scripts 

    task_defaults: 

      trial_attachments:
        logs:
          glob: log/*.log
          content-type: text/plain

      tree_attachments:
        logs:
          glob: log/*.log
          content-type: text/plain

      environment_variables:
        the_answer: 42


    tasks:
    - name: Success with exactly p=1/7 
      eager_trials: 3
      auto_trials: 10
      scripts: 
        main:
          body: ./bin/randomly-failing
    - name: Timeout for a randomly sleeping bash script
      scripts: 
        main:
          body: ./bin/sleeping-randomly-long
          timeout: 40
    - name: Just sleeping a minute
      scripts: 
        main:
          body: sleep 60 && exit 0 
    - name: Just sleeping two minutes
      scripts: 
        main:
          body: sleep 120 && exit 0 
    - name: Just sleeping three minutes
      scripts: 
        main:
          body: sleep 180 && exit 0 
    - name: Create an log file to be attached
      scripts:
        main: 
          body: mkdir -p log &&
                echo '[INFO] Hello World!' > log/hello.log
                

