_cider-ci_include: .cider-ci/shared/defaults.yml

script-defaults: 
  body: echo $(date) && sleep 1 && echo $(date) && test a = a

tasks:

- name: Fail
  description: |
    This tasks has one script which will fail, hence the task will fail. 
  scripts: 
  - name: script-failing
    body: echo $(date) && sleep 1 && echo $(date) && test a = b

- name: Fail and ignore
  description: |
    This tasks has one script which will fail but is ignored, hence the task succeeds. 
  scripts: 
  - name: script-failing
    body: echo $(date) && sleep 1 && echo $(date) && test a = b
    ignore-state: true

- name: Skip
  description: |
    This tasks has one script which will be skipped because the dependency
    is never met, hence the task should fail.
  scripts: 
  - name: unmet-dependency
    body: echo $(date) && sleep 1 && echo $(date) && test a = b
    dependencies:
    - type: script
      name: script-root
      states: [passed]

- name: Skip but ignore 
  description: |
    This tasks has one script which will be skipped because the dependency
    is never met. However it is ignored and hence the task should pass.
  scripts: 
  - name: unmet-dependency
    body: echo $(date) && sleep 1 && echo $(date) && test a = b
    ignore-state: true
    dependencies:
    - type: script
      name: script-root
      states: [passed]
    ignore-state: true

- name: All in one
  description: |
    This tasks shows all the preceding features.
  scripts:
    script-root: {}
    script-depending-root-passed: 
      dependencies:
      - type: script
        name: script-root
        states: [passed]
    script-failing:
      body: echo $(date) && sleep 1 && echo $(date) && test a = b
      ignore-state: true
      dependencies:
        script-depending-root-passed: 
          states: [passed]
    script-depend-failing-failed-passed:
      ignore-state: true
      dependencies:
        script-failing:
          states: [passed]
    script-depend-failing-failed:
      dependencies:
        script-failing: 
          states: [failed]

